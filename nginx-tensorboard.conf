# Nginx configuration for TensorBoard with Basic Authentication
#
# Installation:
# 1. Install htpasswd: sudo apt install apache2-utils
# 2. Create password file: sudo htpasswd -c /etc/nginx/.htpasswd username
# 3. Add more users: sudo htpasswd /etc/nginx/.htpasswd another_user
# 4. Copy config: sudo cp nginx-tensorboard.conf /etc/nginx/sites-available/tensorboard
# 5. Enable site: sudo ln -s /etc/nginx/sites-available/tensorboard /etc/nginx/sites-enabled/
# 6. Test & restart: sudo nginx -t && sudo systemctl restart nginx

server {
    listen 80;
    server_name _;  # Accept any IP/domain

    # Optional: Redirect HTTP to HTTPS (after setting up SSL)
    # return 301 https://$server_name$request_uri;

    location /tensorboard/ {
        # Basic Authentication
        auth_basic "TensorBoard Access";
        auth_basic_user_file /etc/nginx/.htpasswd;

        # Proxy to TensorBoard running on localhost:6006
        proxy_pass http://localhost:6006/;

        # WebSocket support for live updates
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";

        # Proxy headers
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # Timeouts (important for long-running requests)
        proxy_read_timeout 86400;
        proxy_connect_timeout 86400;
        proxy_send_timeout 86400;
    }

    # Optional: Serve a simple status page at root
    location / {
        return 200 "TensorBoard is available at /tensorboard/\n";
        add_header Content-Type text/plain;
    }
}
